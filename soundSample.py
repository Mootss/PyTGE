from main import *
import time


# set up the screen here
screen = Screen(
    colorMode=256,
    height=32,
    width=64,
    color=1 
)

bg1 = [[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,255,255,255,255,255,255,255,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,255,255,255,255,255,255,255,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,255,255,255,240,0,0,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,240,0,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,0,0,0,0,0,0,255,240,0,0,255,255,255,240,0,0,255,240,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,255,255,255,255,0,0,0,244,255,255,255,255,255,255,255,0,244,255,255,255,0,0,0,0,244,255,255,255,0,244,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,255,255,255,255,0,0,0,244,255,255,255,255,255,255,255,0,244,255,255,255,255,0,0,244,255,255,255,255,0,244,255,255,255,255,255,255,255,255,0,0,0,0,0,255,255,255,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,255,255,255,244,255,255,255,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,244,255,255,255,255,255,244,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,255,255,255,255,255,0,244,255,255,0,244,255,255,255,0,244,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,255,255,255,255,255,0,244,255,255,0,0,244,255,0,0,244,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,0,0,0,0,0,0,244,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,255,255,255,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,0,0,0,244,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,0,0,0,0,0,0,244,255,255,0,244,255,255,0,0,0,244,255,255,0,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,255,255,255,255,0,0,0,244,255,255,255,255,255,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,0,244,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0,0,0,0,0],[0,0,244,255,255,255,255,255,255,0,0,0,244,255,255,255,255,255,255,255,0,244,255,255,0,0,0,0,0,0,244,255,255,0,244,255,255,255,255,255,255,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]


def ready(game):
        
    with open("db.json", "r") as f:
        db = json.load(f)
    game.sound = Audio(
        sounds= {**db["sounds"]["music"], **db["sounds"]["sfx"]}
    )
    
    print("\033[2J\33[?25l") # clear screen + hide cursor
    game.prevTime = time.time()
    game.FPS = 1
    game.move = "Use arrow keys to move!"
    game.input = InputHandler(["esc", "q", "1", "2", "3", "x"])

    bg = PixelSprite((0,0), frames=(bg1,))

    game.box = bg
    game.box.screen = screen
    game.textbox = TextBox((66, 7), (50, 30), None, [], text=["123","45678","90"]) 
    game.textbox.screen = screen

def process(game):
    # handle input
    game.input.updateKeyStates()
    keyDown = game.input.keyDown

    if keyDown(["esc", "q"]):
        game.sound.cleanup() # upon exit, cleanup() should be used to delete all temp files, this is not necessary but should be used to avoid cluttering
        return True

    elif keyDown("1"):
        game.sound.play("theme-music", loop=True)

    elif keyDown("2"):
        game.sound.play("game-over")
        
    elif keyDown("3"):
        game.sound.play("mario-die")
        
    elif keyDown("x"):
        game.sound.stop()

    # draw to console
    game.textbox.draw()
    game.box.draw()
    
    # debugging stuff
    #time.sleep(0.05) # control framerate
    now = time.time()
    dt = now - game.prevTime
    game.prevTime = now
    if dt > 0:
        currentFPS = 1 / dt
        game.FPS = 0.9 * game.FPS + 0.1 * currentFPS

    game.textbox.text = [
        f"FPS: {game.FPS:.2f}",
        "-------------------------",
        "Click a number to play a sound. Click 'x' to stop playing a sound.",
        "1- Theme song",
        "2- Gameover",
        "3- Mario die",
        "-------------------------",
        "click 'q' to quit",
    ]

game = Game(ready, process)
game.start()